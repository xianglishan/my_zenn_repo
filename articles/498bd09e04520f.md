---
title: "pythonã‚‚Rã‚‚SQLã‚‚ã‚„ã‚ŠãŸã„äººã®ãŸã‚ã®docker-compose"
emoji: "ğŸ’¢"
type: "tech"
topics:
  - "docker"
  - "jupyternotebook"
  - "python"
  - "r"
  - "sql"
published: true
published_at: "2021-10-11 21:26"
---

TL;DR
- docker-composeã§jupyterlabã¨mysqlç”¨æ„ã—ã¦python, R, SQLã®å­¦ç¿’ç’°å¢ƒä½œã£ãŸã‚ˆ
- githubç½®ã„ã¨ãã‹ã‚‰git cloneã—ã¦ä½¿ãˆã‚‹ã¨æ€ã†ã‚ˆ(README.mdèª­ã‚“ã§ã­)

https://github.com/xianglishan/jupyterlab-mysql_by_dockercompose
## ã¯ã˜ã‚ã«
---
ã“ã‚Œã¯å‚™å¿˜éŒ²ã¨ã—ã¦æ›¸ãã¾ã™ãŒç’°å¢ƒä½œã‚‹ã ã‘ãªã®ã§ä¸­èº«ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ç’°å¢ƒä½œã‚‹ã®é›£ã—ã„ã ã‚‹ã„ã£ã¦ã„ã†å‹‰å¼·ã—å§‹ã‚ã®äººãŸã¡ãŒè¦‹ã¦ãã‚Œã¦ç°¡å˜ã‚„ã‚“ã£ã¦ãªã£ãŸã‚‰ã„ã„ã­ã€‚

ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã—ã¦ä»¥ä¸‹
- docker-compose+dockerfileã§ãªã«ã‹ã—ãŸã„
- ç’°å¢ƒã”ã¨å­¦ç¿’å±¥æ­´ã‚’æ®‹ã—ãŸã„
- jupyterã§ãªã‚“ã§ã‚‚å‹‰å¼·ã—ã‚ˆã†ãœ

ãã—ã¦è€ƒãˆãŸã®ãŒä»¥ä¸‹
- å‰ã‚„ã£ãŸAzureVMã«jupyterlabå»ºã¦ã‚‹ã‚„ã¤ã§ä½¿ã£ãŸjupyter/datascience-notebookä½¿ãŠã†
- MySQLã‚‚Dockerã§ç”¨æ„ã—ã‚ˆã†
- ã‚ã¨ã¯ã„ã„æ„Ÿã˜ã«ç¹‹ã’ãŸã‚‰ã§ããã†

ã¾ã¨ã‚ã‚‹ã¨
- docker-composeã§jupyterlabã¨mysqlç”¨æ„ã—ã¦python, R, SQLã®å­¦ç¿’ç’°å¢ƒä½œã£ãŸã‚ˆ

ã¡ãªã¿ã«æŠ€è¡“çš„é›£æ˜“åº¦ã¯ã‚ã¡ã‚ƒãã¡ã‚ƒä½ã„ã¨æ€ã„ã¾ã™ã€‚
ã‚„ã‚‹ã“ã¨ã¯ãªã‚‹ã¹ãå…¨éƒ¨æ›¸ãã¾ã™ãŒã‚ã¡ã‚ƒãã¡ã‚ƒå‚è€ƒã«ãªã‚‹urlè²¼ã£ã¦ã•ã¼ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
## ã‚„ã£ãŸã“ã¨
---
- windowsã«docker desktopå…¥ã‚Œã¾ã™(wslã„ã‚‰ãªã„ã¨æ€ã†)
- docker-compose.ymlã¨ã‹æ›¸ã„ãŸã‚Šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œã£ãŸã‚Šã—ã¾ã™(ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã¯ä½•ã§ã‚‚ã„ã„ã¨æ€ã†)
- docker-compose up -d --buildã—ã¾ã™
- å®Œæˆ&ãƒ†ã‚¹ãƒˆ

ä»¥ä¸‹ãã‚Œãã‚Œè©³ç´°
### 1, docker desktopå…¥ã‚Œã¾ã™
https://www.docker.com/products/docker-desktop
ã“ã“ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã¯ã‚„ã£ã¦ã¿ã¦ã‚‚ä½•èµ·ãã¦ã‚‹ã®ã‹ã‚ˆãã‚ã‹ã‚‰ãªã„ã®ã§ã‚„ã‚‰ãªã„ã§ã„ã„ã§ã™ã€‚
ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å‡ºæ¥ãŸã‚‰cmdã§
```bash:cmd
docker --version
```
ã—ã¦ã¿ã‚‹ã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æ•™ãˆã¦ãã‚Œã¾ã™ã€‚å¤šåˆ†ã ã‘ã©wslã„ã‚‰ãªã„ã€‚
ã¡ã‚‡ã£ã¨å‹•ä½œé‡ã„ã‘ã©ã‚³ãƒ³ãƒ†ãƒŠ/ã‚¤ãƒ¡ãƒ¼ã‚¸/ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’GUIæ“ä½œã§ãã‚‹ã®ã§ã‚³ãƒ³ãƒ†ãƒŠæ”¾ç½®ã¨ã‹ã‚¤ãƒ¡ãƒ¼ã‚¸æ¶ˆå»å¿˜ã‚Œã¨ã‹ç„¡ããªã‚Šãã†ã§ã¨ã¦ã‚‚å¥½ãã§ã™ã€‚
### 2, docker-compose.ymlã¨ã‹æ›¸ãã¾ã™
ä»¥ä¸‹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã‚’ä½œã‚Šã¾ã™ã€‚
```
    jupyterlab/
    â”œâ”€ db/                             # db(mysql)ã®ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–/volumesç”¨
    â”‚   â”œâ”€ conf.d/                     # æ–‡å­—ã‚³ãƒ¼ãƒ‰ã¨ã‹ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’my.cnfã«æ›¸ã
    â”‚   â”‚   â””â”€ my.cnf                  # 
    â”‚   â”œâ”€ data01/                     # mysqlã®dataãŒãŸãã•ã‚“
    â”‚   â”œâ”€ docker-entrypoint-initdb.d/ # åˆæœŸãƒ‡ãƒ¼ã‚¿æŒ¿å…¥ç”¨
    â”‚   â”‚   â””â”€ world.sql.gz            # .sh, .sql, .sql.gzã¨ã‹åˆæœŸãƒ‡ãƒ¼ã‚¿ç”¨sqlæ–‡ã‚’ç½®ã„ã¦ãŠã
    â”‚   â””â”€ work/                       # .sqlãƒ•ã‚¡ã‚¤ãƒ«ã¨ã‹ç½®ã„ã¦ãŠãä½œæ¥­ç”¨
    â”‚
    â”œâ”€ notebook/                       # jupyterlabã®ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–/volumesç”¨
    â”‚   â”œâ”€ data/                       # imageã¨ã‹ä½œæ¥­ç”¨
    â”‚   â””â”€ work/                       # ipynbã¨ã‹ä½œæ¥­ç”¨
    |
    â”œâ”€ dockerfile/                     # å¾Œè¿°
    â”‚   â””â”€ dockerfile                  # 
    â”‚
    â””â”€ docker-compose.yml              # å¾Œè¿°
```
ä¸­èº«ã®ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¯ä»¥ä¸‹ã§ã™ã€‚æŠ˜ã‚ŠãŸãŸã‚“ã§ã¾ã™
:::details my.conf
```conf:my.conf
[mysqld]
character-set-server=utf8
[client]
default-character-set=utf8
```
:::
:::details docker-compose.yml
```yml:docker-compose.yml
version: "3"
services:
  notebook:
    build:
      context: .
      dockerfile: ./dockerfile/dockerfile
    ports:
      - "8888:8888"
    environment:
      - JUPYTER_ENABLE_LAB=yes
    volumes:
      - ./notebook:/home/jovyan/notebook
      # ä»¥ä¸‹2è¡Œã¯gitã®ãŸã‚ã®è¨­å®šãªã®ã§ãã‚Œãã‚Œã®ç’°å¢ƒã«æ›¸ãæ›ãˆãˆã‚‹ or æ¶ˆã—ã¦ãã ã•ã„
      - /home/xiang/.ssh:/home/jovyan/.ssh
      - /home/xiang/.gitconfig:/home/jovyan/.gitconfig
    command: start-notebook.sh --NotebookApp.token=''
  
  db:
    image: mysql:5.7.16
    volumes:
      - ./db/data01:/var/lib/mysql
      - ./db/conf.d:/etc/mysql/conf.d
      - ./db/docker-entrypoint-initdb.d:/docker-entrypoint-initdb.d
    command: --default-authentication-plugin=mysql_native_password
    cap_add:
      - SYS_NICE
    ports:
      - "3306:3306"
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: pass01
      MYSQL_DATABASE: world
      MYSQL_USER: user01
      MYSQL_PASSWORD: pass01
```
:::
:::details dockerfile
```dockerfile:dockerfile
FROM jupyter/datascience-notebook

USER root

SHELL ["/bin/bash", "-o", "pipefail", "-c"]
RUN apt-get update && \
    apt-get -y install gcc libmariadb-dev

USER jovyan
WORKDIR /home/jovyan

RUN pip install mysqlclient
```
:::
world.sql.gzã¯mysqlã«åˆæœŸãƒ‡ãƒ¼ã‚¿ã¶ã¡è¾¼ã‚“ã§ã‚‹ã ã‘ãªã®ã§ãªãã¦ã‚‚ã„ã„ã‚ˆ
ç§ã¯ä»¥ä¸‹ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ç½®ã„ãŸã ã‘
https://github.com/kakakakakku/mysql-world-database-dockerfiles/blob/master/5.5/world.sql.gz
docker-compose.ymlã¨dockerfileã§æŒ‡å®šã—ãŸæ„Ÿã˜ã«ç’°å¢ƒãŒå‡ºæ¥ä¸ŠãŒã‚Šã¾ã™ã€‚

å…¬å¼ã®Docsè¦‹ã¦ã‚‚ã„ã„ã‘ã©ç§ã®ã‚ˆã†ãªè€…ã«ã¯Qiitaã‚„ã“ã®ZennãŒã‚ã‹ã‚Šã‚„ã™ã„ã®ã§å¥½ãã§ã™ã€‚
- dockerã«ã¤ã„ã¦ã¯ä»¥ä¸‹ãŒã‚ã‹ã‚Šã‚„ã™ã„

https://qiita.com/etaroid/items/b1024c7d200a75b992fc
- docker-composeã«ã¤ã„ã¦ã¯ä»¥ä¸‹

https://qiita.com/yuta-ushijima/items/d3d98177e1b28f736f04
- dockerfileã«ã¤ã„ã¦ã¯ä»¥ä¸‹

https://qiita.com/yuta-ushijima/items/4633fb69c0540fc22ccb
- docker-composeã¨dockerfileã©ã£ã¡ã‚‚ä½¿ã†ã®ã¯ãªãœã‹ã«ã¤ã„ã¦ã¯ä»¥ä¸‹

https://qiita.com/sugurutakahashi12345/items/0b1ceb92c9240aacca02
- ãã‚Œä»¥å¤–ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¤ã„ã¦ã¯volumesç”¨ã§ã€ã“ã‚“ãªæ„Ÿã˜ãªã‚‰ä½œæ¥­ã—ã‚„ã™ã„ã‹ãªï½ã£ã¦ç½®ã„ãŸã‚‚ã®ã§ã™ã€‚å¿…è¦ã ã£ãŸã‚Šå¿…è¦ã˜ã‚ƒãªã‹ã£ãŸã‚Šã—ã¾ã™ã€‚dockerã«ã¤ã„ã¦ã¨jupyterlab/mysqlã«ã¤ã„ã¦èª¿ã¹ã‚‹ã¨ã„ã„ã‹ã‚‚ã€‚

- ä»Šå›ã¯docker-compose.ymlã§volumesã¨ã‹portã¨ã‹ã‚ˆãè¦‹ã‚‹æ„Ÿã˜ã«ã—ã¦ã„ã¦ã€dockerfileã§sqlalchemyã§mysqlã«è§¦ã‚Œã‚‹ã‚ˆã†ã«pip install mysqlclientã—ã¦ã‚‹ã€‚

### 3, docker-compose up -d --buildã—ã¾ã™
```bash:cmd
docker-compose up -d --build
```
ã™ã‚‹ã¨ã„ã„æ„Ÿã˜ã«buildã—ã¦upã—ã¾ã™ã€‚ãŸã¶ã‚“å‡ºæ¥ä¸ŠãŒã‚‹ã“ã‚ã«ã¯docker desktopã§ã‚¤ãƒ¡ãƒ¼ã‚¸/ã‚³ãƒ³ãƒ†ãƒŠ/ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’ã“ã‚“ãªæ„Ÿã˜ã§GUIæ“ä½œã§ãã‚‹ã‚ˆã€‚
![](https://storage.googleapis.com/zenn-user-upload/24edb5064b1b7ea5d63d5b09.png)
5åˆ†ãã‚‰ã„ã‹ã‹ã‚‹ã‹ã‚‚çŸ¥ã‚Œã‚“ã€‚ç„¡äº‹å‡ºæ¥ä¸ŠãŒã£ãŸã‚‰
`http://localhost:8888`ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§è¦‹ã¦ã¿ã‚‹
ã“ã‚“ãªæ„Ÿã˜ã§jupyterlabã§ãã‚‹ã¯ãš
![](https://storage.googleapis.com/zenn-user-upload/ac3ed0fcaf14bba4107d91d3.png)

ã¡ãªã¿ã«ä½¿ã‚ãªã„ã¨ãã¯docker-compose stopã—ã¦ä½¿ã†ã¨ãã«docker-compose startã—ãŸã‚Šã—ã¦ä½¿ãˆã¾ã™ã€‚docker desktopã§GUIæ“ä½œå¯ã§ã™ã€‚
docker-composeã‚³ãƒãƒ³ãƒ‰ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ãŒã‚ã‹ã‚Šã‚„ã™ã„
https://qiita.com/nikadon/items/995c5705ff1171f7484d

### 4, å®Œæˆ
- githubã®ã›ã¨ãã¾ã™
.gitignoreã¨ã‹.gitkeepã¨ã‹æ…£ã‚Œã¦ãªã„ã®ã§ã¡ã‚ƒã‚“ã¨æ•´å‚™ã§ãã¦ãªã„ã§ã™ã€‚
**git cloneã—ãŸã‚‰jupyterlab-mysql_by_dockercompose/db/data01/readme.txtã®ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«æ¶ˆã—ã¦ã‹ã‚‰docker-compose upã—ã¦ãã ã•ã„ã€‚**

https://github.com/xianglishan/jupyterlab-mysql_by_dockercompose

pythonã¨Rã¯launcherã‹ã‚‰é–‹ã„ãŸã‚‰ã‹ã‘ã‚‹ã‘ã©sqlã¯ã¡ã‚‡ã£ã¨ã ã‘ã‚ã‚“ã©ãã•ã„ã§ã™ã€‚
pythonã®moduleä½¿ã£ã¦sqlå©ãæ„Ÿã˜ãªã®ã§pythonã®ãƒãƒ¼ãƒˆãƒ–ãƒƒã‚¯ã§ä¸‹ç”»åƒã®æ„Ÿã˜ã§ã‚„ã£ã¦ãã ã•ã„ã€‚ä¸Šè¨˜githubã«ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚ã‚‹ã®ã§å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚
![](https://storage.googleapis.com/zenn-user-upload/aacbbd5579919e9ca29e8867.png)
![](https://storage.googleapis.com/zenn-user-upload/3046b5340bcfb011ad896063.png)

#### 5, æ„Ÿæƒ³/è£œè¶³
- ä»Šå›ã¯ãƒ†ã‚¹ãƒˆç”¨ã«world.sql.gzã§åˆæœŸæŒ¿å…¥ãƒ‡ãƒ¼ã‚¿ä½œã£ãŸã‘ã©.sqlãƒ•ã‚¡ã‚¤ãƒ«ã‚ã£ãŸã‚‰ä½•ã§ã‚‚ã‚ˆã„æ°—ãŒã™ã‚‹(docker-entrypoint-initdb.d/ã«å…¥ã‚Œã¨ã„ãŸã‚‰ã„ã„ã‚ˆ)ã€‚ã‚ãã¾ã§å­¦ç¿’ç”¨ã®ç’°å¢ƒ
- ä»Šå›ã¯dbã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã«dockerã§ç”¨æ„ã—ãŸã‘ã©ã€dbã‚µãƒ¼ãƒãƒ¼ãŒã‚ã£ã¦ãã‚Œã‚’åˆ†æã—ãŸã‚Šã™ã‚‹å ´åˆSQLAlchemyã§ä»Šå›ã¨åŒæ§˜ã«ã™ã‚Œã°ç°¡å˜ã«dataframeã¨ã—ã¦æ‰±ãˆãã†ã€‚
- ã“ã‚Œã¾ã§ã¯docker-composeæ›¸ã„ã¦upã™ã‚‹ã ã‘ã ã£ãŸã‘ã©ã€ãŸã¶ã‚“æœ¬å‘½ã®ä½¿ã„æ–¹ã¯ã€ŒDockerhubã‹ã‚‰pullã—ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒŠä½œã£ã¦ã€å†…éƒ¨æ§‹æˆã¨ã‹ã‚’(dockerfileæ›¸ã„ã¦build)ã¨ã‹ã§ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦ã€ã»ã‚“ã§ã§ããŸã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä»²é–“ã§å…±æœ‰ã—ãŸã‚Šç’°å¢ƒã”ã¨æ®‹ã—ã¦å†åˆ©ç”¨ã—ãŸã‚Šç ´æ£„ã—ãŸã‚Šã™ã‚‹ã€ã£ã¦ã¨ã“ã‚ã§ãã‚Œã«ä¸€æ­©è¿‘ã¥ã„ãŸæ°—ãŒã™ã‚‹ã€‚

## ãŠã‚ã‚Š
---
outputã™ã‚‹ã“ã¨ã«å°‘ã—ã ã‘ãªã‚ŒãŸã‹ã‚‚
ä»Šå›ä½œã£ãŸç’°å¢ƒã«ã¡ã‚‡ãã¡ã‚‡ãå¿…è¦ãã†ãªã®è¿½åŠ ã—ãŸã‚Šã—ã¦æœ€é«˜ã®jupyterç’°å¢ƒã«ã—ã¦ã„ãäºˆå®šãªã®ã§ä¸Šè¨˜ã®githubã¯å¤‰ã‚ã£ã¦ã„ãã‹ã‚‚
